<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3D Rubik's Cube Color Editor</title>
    <style>
        :root {
            --size: 240px;
            --grid-size: 3;
            --sticker: calc(var(--size) / var(--grid-size));
            --gap: 4px;
        }

        * {
            box-sizing: border-box;
            font-family: Inter, system-ui, Arial;
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #0b0f14, #071018);
            color: #e6eef8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            font-size: 20px;
            margin-bottom: 10px;
            text-align: center;
        }

        p {
            font-size: 14px;
            color: #a9b4c2;
            margin-bottom: 20px;
            text-align: center;
        }

        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .swatch {
            width: 36px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .swatch.selected {
            outline: 3px solid rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .btn {
            background: #1b2835;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            cursor: pointer;
        }

        .btn:hover {
            background: #24384c;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .size-selector {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-selector select {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #3a4756;
            background: #1b2835;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .stage {
            width: 55%;
            max-width: 420px;
            height: 420px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 40px;
        }

        .scene {
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }

        .cube {
            width: var(--size);
            height: var(--size);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        .face {
            position: absolute;
            width: var(--size);
            height: var(--size);
            display: grid;
            grid-template-columns: repeat(var(--grid-size), 1fr);
            grid-template-rows: repeat(var(--grid-size), 1fr);
            gap: var(--gap);
            padding: var(--gap);
            background: rgba(0, 0, 0, 0.35);
            border-radius: 8px;
        }

        .sticker {
            background: #888;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .sticker-shape-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sticker-shape-container svg {
            width: 80%;
            height: 80%;
            transition: transform 0.1s ease-out;
        }

        .face.front {
            transform: translateZ(calc(var(--size)/2));
        }

        .face.back {
            transform: rotateY(180deg) translateZ(calc(var(--size)/2));
        }

        .face.right {
            transform: rotateY(90deg) translateZ(calc(var(--size)/2));
        }

        .face.left {
            transform: rotateY(-90deg) translateZ(calc(var(--size)/2));
        }

        .face.top {
            transform: rotateX(90deg) translateZ(calc(var(--size)/2));
        }

        .face.bottom {
            transform: rotateX(-90deg) translateZ(calc(var(--size)/2));
        }

        @media(max-width:600px) {
            :root {
                --size: 180px;
            }

            .stage {
                height: 300px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        #shapeModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #shapeModal.active {
            display: flex;
        }

        .modal-content {
            background: #0e1620;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .shape-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .shape-item {
            width: 60px;
            height: 50px;
            background: #1b2835;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .shape-item.selected {
            outline: 2px solid #4da3ff;
            transform: translateY(-2px);
        }

        .shape-item svg {
            width: 70%;
            height: 70%;
        }

        .rotate-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .rotate-btn {
            font-size: 20px;
            background: #1b2835;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
        }

        .rotate-btn:hover {
            background: #24384c;
        }
    </style>
</head>

<body>
    <h1>3D Rubik's Cube Color Editor</h1>
    <p>Click on any square to color or shape it</p>

    <svg style="display:none;" xmlns="http://www.w3.org/2000/svg">
        <symbol id="arrow-up" viewBox="0 0 100 100">
            <path d="M50 0 L20 40 L40 40 L40 100 L60 100 L60 40 L80 40 Z" fill="currentColor" />
        </symbol>
        <symbol id="circle" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" fill="currentColor" />
        </symbol>
        <symbol id="square-shape" viewBox="0 0 100 100">
            <rect x="10" y="10" width="80" height="80" fill="currentColor" />
        </symbol>
    </svg>
    <div class="palette" id="palette"></div>

    <div class="size-selector">
        <label>Cube Size:</label>
        <select id="cube-size">
            <option value="2">2x2</option>
            <option value="3" selected>3x3</option>
            <option value="4">4x4</option>
            <option value="5">5x5</option>
        </select>
    </div>

    <div class="buttons">
        <button class="btn" id="shapes-btn">Shapes</button>
        <button class="btn" id="undo">Undo</button>
        <button class="btn" id="reset">Reset</button>
    </div>

    <div class="stage">
        <div class="scene">
            <div class="cube" id="cube"></div>
        </div>
    </div>

    <footer>Made by MCB</footer>

    <!-- Shape Popup -->
    <div id="shapeModal">
        <div class="modal-content">
            <h2>Select Shape</h2>
            <div class="shape-list" id="shape-list"></div>
            <div class="rotate-controls">
                <button class="rotate-btn" id="rotate-left">⟲</button>
                <button class="rotate-btn" id="rotate-right">⟳</button>
            </div>
            <button class="btn" id="closeModal">Close</button>
        </div>
    </div>

    <script>
        const paletteColors = [{
                name: 'White',
                color: '#fff'
            },
            {
                name: 'Yellow',
                color: '#ffd400'
            },
            {
                name: 'Orange',
                color: '#ff7a00'
            },
            {
                name: 'Red',
                color: '#d92b2b'
            },
            {
                name: 'Blue',
                color: '#2b5bd9'
            },
            {
                name: 'Green',
                color: '#2bbd52'
            },
            {
                name: 'Gray',
                color: '#888'
            }
        ];
        const shapeOptions = [{
                name: 'None',
                id: 'none'
            },
            {
                name: 'Arrow Up',
                id: 'arrow-up'
            },
            {
                name: 'Circle',
                id: 'circle'
            },
            {
                name: 'Square',
                id: 'square-shape'
            }
        ];

        const paletteEl = document.getElementById('palette');
        paletteColors.forEach((p, i) => {
            const s = document.createElement('div');
            s.className = 'swatch' + (i === 0 ? ' selected' : '');
            s.style.background = p.color;
            s.title = p.name;
            s.onclick = () => {
                document.querySelectorAll('.palette .swatch').forEach(x => x.classList.remove('selected'));
                s.classList.add('selected');
                selectedColor = p;
            };
            paletteEl.appendChild(s);
        });

        let selectedColor = paletteColors[0];
        let selectedShape = shapeOptions[0];
        let lastClickedSticker = null;
        let undoStack = [];
        const faces = ['front', 'back', 'right', 'left', 'top', 'bottom'];
        let currentGridSize = 3;
        const MAX_UNDO = 50;

        function getCubeState() {
            const state = {};
            document.querySelectorAll('.sticker').forEach(st => {
                const f = st.dataset.face;
                if (!state[f]) state[f] = [];
                state[f].push({
                    bg: st.style.background,
                    id: st.dataset.shapeId || null,
                    rot: st.dataset.shapeRotation || '0',
                    color: st.dataset.shapeColor || null
                });
            });
            return JSON.stringify(state);
        }

        function applyCubeState(stateString) {
            const state = JSON.parse(stateString);
            document.querySelectorAll('.sticker').forEach(st => {
                const f = st.dataset.face;
                const idx = [...st.parentNode.children].indexOf(st);
                if (state[f] && state[f][idx]) {
                    const ss = state[f][idx];
                    st.style.background = ss.bg;
                    const cont = st.querySelector('.sticker-shape-container');
                    cont.innerHTML = '';
                    if (ss.id && ss.id !== 'none') {
                        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('viewBox', '0 0 100 100');
                        svg.innerHTML = `<use href="#${ss.id}" fill="${ss.color||'#888'}"/>`;
                        svg.style.transform = `rotate(${ss.rot}deg)`;
                        cont.appendChild(svg);
                        st.dataset.shapeId = ss.id;
                        st.dataset.shapeRotation = ss.rot;
                        st.dataset.shapeColor = ss.color;
                    } else {
                        delete st.dataset.shapeId;
                        delete st.dataset.shapeRotation;
                        delete st.dataset.shapeColor;
                    }
                }
            });
        }

        function saveUndo() {
            const s = getCubeState();
            if (undoStack[undoStack.length - 1] !== s) {
                undoStack.push(s);
                if (undoStack.length > MAX_UNDO) undoStack.shift();
            }
            document.getElementById('undo').disabled = undoStack.length <= 1;
        }

        function initializeCube(n) {
            currentGridSize = n;
            document.documentElement.style.setProperty('--grid-size', n);
            const cube = document.getElementById('cube');
            cube.innerHTML = '';
            faces.forEach(face => {
                const el = document.createElement('div');
                el.className = 'face ' + face;
                for (let i = 0; i < n * n; i++) {
                    const st = document.createElement('div');
                    st.className = 'sticker';
                    st.dataset.face = face;
                    st.style.background = '#888';
                    const sc = document.createElement('div');
                    sc.className = 'sticker-shape-container';
                    st.appendChild(sc);
                    st.onclick = (e) => {
                        lastClickedSticker = e.currentTarget;
                        saveUndo();
                        if (selectedShape.id === 'none') {
                            st.style.background = selectedColor.color;
                            sc.innerHTML = '';
                            delete st.dataset.shapeId;
                            delete st.dataset.shapeRotation;
                            delete st.dataset.shapeColor;
                        } else {
                            st.style.background = selectedColor.color;
                            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                            svg.setAttribute('viewBox', '0 0 100 100');
                            svg.innerHTML = `<use href="#${selectedShape.id}" fill="${selectedColor.color}"/>`;
                            svg.style.transform = 'rotate(0deg)';
                            sc.innerHTML = '';
                            sc.appendChild(svg);
                            st.dataset.shapeId = selectedShape.id;
                            st.dataset.shapeRotation = '0';
                            st.dataset.shapeColor = selectedColor.color;
                        }
                        saveUndo();
                    };
                    el.appendChild(st);
                }
                cube.appendChild(el);
            });
            undoStack = [];
            saveUndo();
        }
        initializeCube(currentGridSize);

        document.getElementById('cube-size').onchange = e => initializeCube(parseInt(e.target.value));
        document.getElementById('undo').onclick = () => {
            if (undoStack.length > 1) {
                undoStack.pop();
                applyCubeState(undoStack[undoStack.length - 1]);
                undoStack.length <= 1 && (document.getElementById('undo').disabled = true);
            }
        };
        document.getElementById('reset').onclick = () => initializeCube(currentGridSize);

        let rotX = -20,
            rotY = -30;
        const cube = document.getElementById('cube');

        function upd() {
            cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
        }
        upd();
        let dragging = false,
            lastX = 0,
            lastY = 0;
        document.querySelector('.stage').onpointerdown = e => {
            dragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
        };
        document.querySelector('.stage').onpointerup = () => dragging = false;
        document.querySelector('.stage').onpointermove = e => {
            if (!dragging) return;
            rotY += (e.clientX - lastX) * 2;
            rotX -= (e.clientY - lastY) * 2;
            lastX = e.clientX;
            lastY = e.clientY;
            upd();
        };

        const modal = document.getElementById('shapeModal');
        const shapeList = document.getElementById('shape-list');
        shapeOptions.forEach((sh, i) => {
            const div = document.createElement('div');
            div.className = 'shape-item' + (i === 0 ? ' selected' : '');
            div.title = sh.name;
            if (sh.id === 'none') div.textContent = 'None';
            else {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 100 100');
                svg.innerHTML = `<use href="#${sh.id}" fill="currentColor"/>`;
                div.appendChild(svg);
            }
            div.onclick = () => {
                document.querySelectorAll('.shape-item').forEach(x => x.classList.remove('selected'));
                div.classList.add('selected');
                selectedShape = sh;
            };
            shapeList.appendChild(div);
        });
        document.getElementById('shapes-btn').onclick = () => modal.classList.add('active');
        document.getElementById('closeModal').onclick = () => modal.classList.remove('active');

        document.getElementById('rotate-left').onclick = () => {
            if (lastClickedSticker && lastClickedSticker.dataset.shapeId && lastClickedSticker.dataset.shapeId !== 'none') {
                saveUndo();
                let r = parseInt(lastClickedSticker.dataset.shapeRotation || '0');
                r = (r - 90 + 360) % 360;
                lastClickedSticker.dataset.shapeRotation = r;
                const svg = lastClickedSticker.querySelector('.sticker-shape-container svg');
                if (svg) svg.style.transform = `rotate(${r}deg)`;
                saveUndo();
            }
        };
        document.getElementById('rotate-right').onclick = () => {
            if (lastClickedSticker && lastClickedSticker.dataset.shapeId && lastClickedSticker.dataset.shapeId !== 'none') {
                saveUndo();
                let r = parseInt(lastClickedSticker.dataset.shapeRotation || '0');
                r = (r + 90) % 360;
                lastClickedSticker.dataset.shapeRotation = r;
                const svg = lastClickedSticker.querySelector('.sticker-shape-container svg');
                if (svg) svg.style.transform = `rotate(${r}deg)`;
                saveUndo();
            }
        };
    </script>
</body>

</html>